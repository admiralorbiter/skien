{% extends "base.html" %}

{% block title %}Admin Dashboard{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h1>Admin Dashboard</h1>
        <p class="admin-subtitle">System Overview and User Management</p>
    </div>

    <!-- Statistics Cards -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-content">
                <h3>{{ stats.total_users or 0 }}</h3>
                <p>Total Users</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-user-check"></i>
            </div>
            <div class="stat-content">
                <h3>{{ stats.active_users or 0 }}</h3>
                <p>Active Users</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-user-shield"></i>
            </div>
            <div class="stat-content">
                <h3>{{ stats.admin_users or 0 }}</h3>
                <p>Admin Users</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-user-plus"></i>
            </div>
            <div class="stat-content">
                <h3>{{ stats.recent_users or 0 }}</h3>
                <p>New Users (30 days)</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-newspaper"></i>
            </div>
            <div class="stat-content">
                <h3>{{ stats.total_stories or 0 }}</h3>
                <p>Total Stories</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-calendar-alt"></i>
            </div>
            <div class="stat-content">
                <h3>{{ stats.total_events or 0 }}</h3>
                <p>Events</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-tags"></i>
            </div>
            <div class="stat-content">
                <h3>{{ stats.total_topics or 0 }}</h3>
                <p>Topics</p>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <h2>Quick Actions</h2>
        <div class="action-buttons">
            <a href="{{ url_for('admin_create_user') }}" class="btn btn-primary">
                <i class="fas fa-user-plus"></i> Create New User
            </a>
            <a href="{{ url_for('admin_users') }}" class="btn btn-secondary">
                <i class="fas fa-users"></i> Manage Users
            </a>
            <a href="{{ url_for('admin_logs') }}" class="btn btn-info">
                <i class="fas fa-history"></i> View Logs
            </a>
            <a href="{{ url_for('admin_stories') }}" class="btn btn-success">
                <i class="fas fa-newspaper"></i> Manage Stories
            </a>
            <a href="{{ url_for('admin_topics') }}" class="btn btn-warning">
                <i class="fas fa-tags"></i> Manage Topics
            </a>
            <a href="{{ url_for('admin_threads') }}" class="btn btn-info">
                <i class="fas fa-sitemap"></i> Manage Threads
            </a>
            <a href="{{ url_for('admin_events') }}" class="btn btn-dark">
                <i class="fas fa-calendar-alt"></i> Manage Events
            </a>
            <a href="{{ url_for('import.index') }}" class="btn btn-outline-primary">
                <i class="fas fa-upload"></i> Import Stories
            </a>
        </div>
    </div>

    <!-- Recent Actions -->
    {% if stats.recent_actions %}
    <div class="recent-actions">
        <h2>Recent Admin Actions</h2>
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Action</th>
                        <th>Target User</th>
                        <th>Details</th>
                        <th>IP Address</th>
                    </tr>
                </thead>
                <tbody>
                    {% for action in stats.recent_actions %}
                    <tr>
                        <td>{{ action.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td>
                            <span class="badge badge-{{ 'success' if action.action == 'CREATE_USER' else 'warning' if action.action == 'UPDATE_USER' else 'danger' }}">
                                {{ action.action.replace('_', ' ').title() }}
                            </span>
                        </td>
                        <td>
                            {% if action.target_user_id %}
                                User #{{ action.target_user_id }}
                            {% else %}
                                N/A
                            {% endif %}
                        </td>
                        <td>{{ action.details or 'N/A' }}</td>
                        <td>{{ action.ip_address or 'N/A' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
{% endblock %}
