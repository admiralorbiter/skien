{% extends "base.html" %}

{% block title %}Create New User{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h1>Create New User</h1>
        <a href="{{ url_for('admin_users') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to Users
        </a>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">User Information</h5>
                </div>
                <div class="card-body">
                    <form method="POST">
                        {{ form.hidden_tag() }}
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    {{ form.username.label(class="form-label") }}
                                    {{ form.username(class="form-control" + (" is-invalid" if form.username.errors else "")) }}
                                    {% if form.username.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.username.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    {{ form.email.label(class="form-label") }}
                                    {{ form.email(class="form-control" + (" is-invalid" if form.email.errors else "")) }}
                                    {% if form.email.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.email.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    {{ form.first_name.label(class="form-label") }}
                                    {{ form.first_name(class="form-control" + (" is-invalid" if form.first_name.errors else "")) }}
                                    {% if form.first_name.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.first_name.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    {{ form.last_name.label(class="form-label") }}
                                    {{ form.last_name(class="form-control" + (" is-invalid" if form.last_name.errors else "")) }}
                                    {% if form.last_name.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.last_name.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    {{ form.password.label(class="form-label") }}
                                    {{ form.password(class="form-control" + (" is-invalid" if form.password.errors else "")) }}
                                    {% if form.password.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.password.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                    <small class="form-text text-muted">
                                        Password must be at least 8 characters with uppercase, lowercase, and digit.
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    {{ form.confirm_password.label(class="form-label") }}
                                    {{ form.confirm_password(class="form-control" + (" is-invalid" if form.confirm_password.errors else "")) }}
                                    {% if form.confirm_password.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.confirm_password.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <div class="form-check">
                                        {{ form.is_active(class="form-check-input", checked=form.is_active.data, style="width: 1.25rem !important; height: 1.25rem !important; appearance: none !important; -webkit-appearance: none !important; -moz-appearance: none !important; background-color: #fff !important; border: 1px solid rgba(0, 0, 0, 0.25) !important; background-repeat: no-repeat !important; background-position: center !important; background-size: contain !important;") }}
                                        {{ form.is_active.label(class="form-check-label") }}
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <div class="form-check">
                                        {{ form.is_admin(class="form-check-input", checked=form.is_admin.data, style="width: 1.25rem !important; height: 1.25rem !important; appearance: none !important; -webkit-appearance: none !important; -moz-appearance: none !important; background-color: #fff !important; border: 1px solid rgba(0, 0, 0, 0.25) !important; background-repeat: no-repeat !important; background-position: center !important; background-size: contain !important;") }}
                                        {{ form.is_admin.label(class="form-check-label") }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group d-flex gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-user-plus me-2"></i> Create User
                            </button>
                            <a href="{{ url_for('admin_users') }}" class="btn btn-secondary">
                                <i class="fas fa-times me-2"></i> Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Function to update checkbox visual state
    function updateCheckboxStyle(checkbox) {
        if (checkbox.checked) {
            checkbox.style.setProperty('background-color', '#B75D69', 'important');
            checkbox.style.setProperty('border-color', '#B75D69', 'important');
            checkbox.style.setProperty('background-image', 'url("data:image/svg+xml,%3csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 20 20\'%3e%3cpath fill=\'none\' stroke=\'%23fff\' stroke-linecap=\'round\' stroke-linejoin=\'round\' stroke-width=\'3\' d=\'m6 10 3 3 6-6\'/%3e%3c/svg%3e")', 'important');
        } else {
            checkbox.style.setProperty('background-color', '#fff', 'important');
            checkbox.style.setProperty('border-color', 'rgba(0, 0, 0, 0.25)', 'important');
            checkbox.style.setProperty('background-image', 'none', 'important');
        }
    }
    
    // Apply initial styling
    const isActiveCheckbox = document.querySelector('input[name="is_active"]');
    const isAdminCheckbox = document.querySelector('input[name="is_admin"]');
    
    updateCheckboxStyle(isActiveCheckbox);
    updateCheckboxStyle(isAdminCheckbox);
    
    // Update visual state when checkboxes change
    isActiveCheckbox.addEventListener('change', function(e) {
        updateCheckboxStyle(e.target);
    });
    
    isAdminCheckbox.addEventListener('change', function(e) {
        updateCheckboxStyle(e.target);
    });
});
</script>
{% endblock %}
