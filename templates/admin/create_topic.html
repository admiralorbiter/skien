{% extends "base.html" %}

{% block title %}Create Topic - Admin - SKIEN{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
<style>
    .color-picker-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 10px;
    }
    
    .color-option {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 3px solid transparent;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
    }
    
    .color-option:hover {
        transform: scale(1.1);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }
    
    .color-option.selected {
        border-color: #007bff;
        box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
    }
    
    .color-option::after {
        content: 'âœ“';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-weight: bold;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .color-option.selected::after {
        opacity: 1;
    }
    
    .form-help {
        font-size: 0.875rem;
        color: #6c757d;
        margin-top: 0.25rem;
    }
    
    .preview-section {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 0.375rem;
        padding: 1rem;
        margin-top: 1rem;
    }
    
    .preview-topic {
        display: flex;
        align-items: center;
        margin-bottom: 0.5rem;
    }
    
    .preview-color {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        margin-right: 10px;
        border: 2px solid #fff;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }
    
    .preview-name {
        font-weight: 600;
        margin: 0;
    }
    
    .preview-description {
        color: #6c757d;
        font-size: 0.9rem;
        margin: 0;
    }
</style>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-3">
        <div class="sidebar">
            <div class="p-3">
                <h6 class="text-muted text-uppercase fw-bold mb-3">Admin Panel</h6>
                <nav class="nav flex-column">
                    <a class="nav-link" href="{{ url_for('admin_dashboard') }}">
                        <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                    </a>
                    <a class="nav-link" href="{{ url_for('admin_users') }}">
                        <i class="fas fa-users me-2"></i>Users
                    </a>
                    <a class="nav-link" href="{{ url_for('admin_stories') }}">
                        <i class="fas fa-newspaper me-2"></i>Stories
                    </a>
                    <a class="nav-link active" href="{{ url_for('admin_topics') }}">
                        <i class="fas fa-tags me-2"></i>Topics
                    </a>
                    <a class="nav-link" href="{{ url_for('admin_events') }}">
                        <i class="fas fa-calendar-alt me-2"></i>Events
                    </a>
                    <a class="nav-link" href="{{ url_for('admin_logs') }}">
                        <i class="fas fa-file-alt me-2"></i>System Logs
                    </a>
                    <a class="nav-link" href="{{ url_for('admin_metrics') }}">
                        <i class="fas fa-chart-bar me-2"></i>Metrics
                    </a>
                </nav>
            </div>
        </div>
    </div>

    <div class="col-md-9">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2><i class="fas fa-plus me-2"></i>Create New Topic</h2>
            <div>
                <a href="{{ url_for('admin_topics') }}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-2"></i>Back to Topics
                </a>
            </div>
        </div>

        <div class="row">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Topic Information</h5>
                    </div>
                    <div class="card-body">
                        <form method="POST" id="topicForm">
                            <div class="mb-3">
                                <label for="name" class="form-label">Topic Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="name" name="name" required 
                                       placeholder="e.g., US Politics, Climate Change, Technology">
                                <div class="form-help">Choose a clear, descriptive name for your topic. This will be used to organize related stories and events.</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="description" class="form-label">Description</label>
                                <textarea class="form-control" id="description" name="description" rows="3" 
                                          placeholder="Optional description of what this topic covers..."></textarea>
                                <div class="form-help">Provide additional context about what this topic encompasses.</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="color" class="form-label">Color</label>
                                <input type="text" class="form-control" id="color" name="color" 
                                       placeholder="#007bff" pattern="^#[0-9A-Fa-f]{6}$">
                                <div class="form-help">Choose a hex color code (e.g., #007bff) for visual identification.</div>
                                
                                <!-- Color Picker Options -->
                                <div class="color-picker-container">
                                    <div class="color-option" data-color="#007bff" style="background-color: #007bff;" title="Blue"></div>
                                    <div class="color-option" data-color="#28a745" style="background-color: #28a745;" title="Green"></div>
                                    <div class="color-option" data-color="#dc3545" style="background-color: #dc3545;" title="Red"></div>
                                    <div class="color-option" data-color="#ffc107" style="background-color: #ffc107;" title="Yellow"></div>
                                    <div class="color-option" data-color="#6f42c1" style="background-color: #6f42c1;" title="Purple"></div>
                                    <div class="color-option" data-color="#fd7e14" style="background-color: #fd7e14;" title="Orange"></div>
                                    <div class="color-option" data-color="#20c997" style="background-color: #20c997;" title="Teal"></div>
                                    <div class="color-option" data-color="#6c757d" style="background-color: #6c757d;" title="Gray"></div>
                                    <div class="color-option" data-color="#e83e8c" style="background-color: #e83e8c;" title="Pink"></div>
                                    <div class="color-option" data-color="#17a2b8" style="background-color: #17a2b8;" title="Cyan"></div>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-between">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-2"></i>Create Topic
                                </button>
                                <a href="{{ url_for('admin_topics') }}" class="btn btn-secondary">
                                    <i class="fas fa-times me-2"></i>Cancel
                                </a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Preview</h5>
                    </div>
                    <div class="card-body">
                        <div class="preview-section">
                            <div class="preview-topic">
                                <div class="preview-color" id="previewColor" style="background-color: #6c757d;"></div>
                                <div>
                                    <h6 class="preview-name" id="previewName">Topic Name</h6>
                                    <p class="preview-description" id="previewDescription">Topic description will appear here...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card mt-3">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Tips</h5>
                    </div>
                    <div class="card-body">
                        <ul class="list-unstyled mb-0">
                            <li class="mb-2">
                                <i class="fas fa-lightbulb text-warning me-2"></i>
                                <small>Choose a clear, specific name that describes the topic's scope.</small>
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-palette text-info me-2"></i>
                                <small>Use colors to visually distinguish topics in lists and views.</small>
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-sitemap text-success me-2"></i>
                                <small>You can create threads within topics to organize events chronologically.</small>
                            </li>
                            <li>
                                <i class="fas fa-edit text-primary me-2"></i>
                                <small>You can always edit the topic details later.</small>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const nameInput = document.getElementById('name');
    const descriptionInput = document.getElementById('description');
    const colorInput = document.getElementById('color');
    const colorOptions = document.querySelectorAll('.color-option');
    const previewName = document.getElementById('previewName');
    const previewDescription = document.getElementById('previewDescription');
    const previewColor = document.getElementById('previewColor');
    
    // Update preview when form changes
    function updatePreview() {
        const name = nameInput.value || 'Topic Name';
        const description = descriptionInput.value || 'Topic description will appear here...';
        const color = colorInput.value || '#6c757d';
        
        previewName.textContent = name;
        previewDescription.textContent = description;
        previewColor.style.backgroundColor = color;
    }
    
    // Color picker functionality
    colorOptions.forEach(option => {
        option.addEventListener('click', function() {
            // Remove selected class from all options
            colorOptions.forEach(opt => opt.classList.remove('selected'));
            // Add selected class to clicked option
            this.classList.add('selected');
            // Update color input
            colorInput.value = this.dataset.color;
            updatePreview();
        });
    });
    
    // Update preview on input change
    nameInput.addEventListener('input', updatePreview);
    descriptionInput.addEventListener('input', updatePreview);
    colorInput.addEventListener('input', function() {
        // Validate hex color format
        const hexPattern = /^#[0-9A-Fa-f]{6}$/;
        if (hexPattern.test(this.value)) {
            updatePreview();
            // Update color picker selection
            colorOptions.forEach(opt => {
                opt.classList.remove('selected');
                if (opt.dataset.color === this.value) {
                    opt.classList.add('selected');
                }
            });
        }
    });
    
    // Form validation
    document.getElementById('topicForm').addEventListener('submit', function(e) {
        const name = nameInput.value.trim();
        if (!name) {
            e.preventDefault();
            alert('Please enter a topic name.');
            nameInput.focus();
            return;
        }
        
        const color = colorInput.value.trim();
        if (color && !/^#[0-9A-Fa-f]{6}$/.test(color)) {
            e.preventDefault();
            alert('Please enter a valid hex color code (e.g., #007bff).');
            colorInput.focus();
            return;
        }
    });
    
    // Initial preview update
    updatePreview();
});
</script>
{% endblock %}
